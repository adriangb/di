
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Simple pythonic dependency injection">
      
      
      
        <link rel="canonical" href="https://www.adriangb.com/di/0.75.3/wiring/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-8.5.10">
    
    
      
        <title>Wiring - di</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/termynal.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wiring" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../.."> <!--  -->
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="di" class="md-header__button md-logo" aria-label="di" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            di
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Wiring
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/adriangb/di" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    adriangb/di
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="di" class="md-nav__button md-logo" aria-label="di" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    di
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/adriangb/di" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    adriangb/di
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Intro
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Wiring
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Wiring
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autowiring" class="md-nav__link">
    Autowiring
  </a>
  
    <nav class="md-nav" aria-label="Autowiring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autowiring-metadata" class="md-nav__link">
    Autowiring metadata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-markers" class="md-nav__link">
    Dependency markers
  </a>
  
    <nav class="md-nav" aria-label="Dependency markers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-note-on-annotated-pep-593" class="md-nav__link">
    A note on Annotated / PEP 593
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-types" class="md-nav__link">
    Custom types
  </a>
  
    <nav class="md-nav" aria-label="Custom types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#injectableclass" class="md-nav__link">
    InjectableClass
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binds" class="md-nav__link">
    Binds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../scopes/" class="md-nav__link">
        Scopes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../binds/" class="md-nav__link">
        Registration and Binding
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dependents/" class="md-nav__link">
        Dependents
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cache/" class="md-nav__link">
        Caching
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../solving/" class="md-nav__link">
        Solving
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API Interface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autowiring" class="md-nav__link">
    Autowiring
  </a>
  
    <nav class="md-nav" aria-label="Autowiring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autowiring-metadata" class="md-nav__link">
    Autowiring metadata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-markers" class="md-nav__link">
    Dependency markers
  </a>
  
    <nav class="md-nav" aria-label="Dependency markers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-note-on-annotated-pep-593" class="md-nav__link">
    A note on Annotated / PEP 593
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-types" class="md-nav__link">
    Custom types
  </a>
  
    <nav class="md-nav" aria-label="Custom types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#injectableclass" class="md-nav__link">
    InjectableClass
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binds" class="md-nav__link">
    Binds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/adriangb/di/blob/main/docs/wiring.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="wiring">Wiring</h1>
<p>Wiring is the act of "connecting" together dependencies.</p>
<p>In <code>di</code>, wiring is handled by the <code>Dependent</code> API.
The general idea is that <code>Container</code> accepts a <code>Dependent</code> and then asks it for it's sub-dependencies.
These sub-dependencies are themselves <code>Dependent</code>s, and so the <code>Container</code> keeps asking them for <em>their</em> sub-dependenices until there are none.</p>
<p>But how does <code>Dependent</code> know what it's dependencies are?
Every <code>Dependent</code> has a <code>call</code> attribute which is a callable (a class, a function, etc.) that which can be introspected (usually with <code>inpsect.signature</code>) to find it's parameters.
The from these parameters the <code>Dependent</code> determine's what it's dependencies are.
But how do we go from a parameter <code>param: Foo</code> to a <code>Dependent</code>?
There are actually several different mechanisms available:</p>
<h2 id="autowiring">Autowiring</h2>
<p>Autowiring is available when the parameter's type annotation is a well-behaved type/class. Well behaved in this case means just means that it's parameters can be understood by <code>di</code>, for example that they are type annotated and are uniquely identifiable (<code>param: int</code> won't work properly).</p>
<p>Here is an example showing auto-wiring in action.</p>
<p>Auto-wiring can work with dataclasses, even ones with a <code>default_factory</code>.
In this example we'll load a config from the environment:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">di.dependent</span> <span class="kn">import</span> <span class="n">Dependent</span>
<span class="kn">from</span> <span class="nn">di.executors</span> <span class="kn">import</span> <span class="n">AsyncExecutor</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>


<span class="k">class</span> <span class="nc">DBConn</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">host</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">conn</span><span class="p">:</span> <span class="n">DBConn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">DBConn</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">framework</span><span class="p">():</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Dependent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;request&quot;</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">])</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">AsyncExecutor</span><span class="p">(),</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
</code></pre></div>
<p>What makes this "auto-wiring" is that we didn't have to tell <code>di</code> how to construct <code>DBConn</code>: <code>di</code> detected that <code>controller</code> needed a <code>DBConn</code> and that <code>DBConn</code> in turn needs a <code>Config</code> instance.</p>
<p>This is the simplest option because you don't have to do anything, but it' relatively limited in terms of what can be injected.</p>
<h3 id="autowiring-metadata">Autowiring metadata</h3>
<p>To execute a dependency, <code>di</code> needs both a callable target (a class, function, etc.) <em>and</em> some metadata, namely <code>scope</code> and <code>use_cache</code>.</p>
<p>Autowiring can discover the callable target from type annotations, but it cannot infer the metadata.
So metadata is just inherited from the parent dependency: in the example above, we declared <code>endpoint</code> as having a <code>"request"</code> scope, so all of the sub-dependencies that get auto-wired end up having the <code>"request"</code> scope.</p>
<h2 id="dependency-markers">Dependency markers</h2>
<p>Dependency markers, in the form of <code>di.dependent.Marker</code> serve to hold information about a dependency, for example how to construct it or it's scope.</p>
<p>Markers are generally useful when:</p>
<ul>
<li>Injecting a non-identifiable type, like a <code>list[str]</code></li>
<li>Injecting the result of a function (<code>param: some_function</code> is not valid in Python)</li>
<li>The type being injected is not well-behaved and you need to tell <code>di</code> how to construct it</li>
<li>You want to attach metadata to the target (like explicitly setting the <code>scope</code>)</li>
</ul>
<p>Let's take our previous example and look at how we would have used markers if <code>DBConn</code> accepted a <code>host: str</code> parameter instead of our <code>Config</code> class directly:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">di.dependent</span> <span class="kn">import</span> <span class="n">Dependent</span><span class="p">,</span> <span class="n">Marker</span>
<span class="kn">from</span> <span class="nn">di.executors</span> <span class="kn">import</span> <span class="n">SyncExecutor</span>
<span class="kn">from</span> <span class="nn">di.typing</span> <span class="kn">import</span> <span class="n">Annotated</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>


<span class="k">class</span> <span class="nc">DBConn</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>


<span class="k">def</span> <span class="nf">inject_db</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DBConn</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">DBConn</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">DBConn</span><span class="p">,</span> <span class="n">Marker</span><span class="p">(</span><span class="n">inject_db</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;request&quot;</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">DBConn</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">framework</span><span class="p">():</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Dependent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;request&quot;</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;request&quot;</span><span class="p">])</span>
    <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
        <span class="n">solved</span><span class="o">.</span><span class="n">execute_sync</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">SyncExecutor</span><span class="p">(),</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
</code></pre></div>
<p>All we had to do was tell <code>di</code> how to construct <code>DBConn</code> (by assigning the parameter a <code>Marker</code>) and <code>di</code> can do the rest.
Note that we are still using autowiring for <code>endpoint</code> and <code>Config</code>, it's not all or nothing and you can mix and match styles.</p>
<h3 id="a-note-on-annotated-pep-593">A note on Annotated / PEP 593</h3>
<p>Markers are set via <a href="https://www.python.org/dev/peps/pep-0593/">PEP 593's Annotated</a>.
This is in contrast to FastAPIs use of markers as default values (<code>param: int = Depends(...)</code>).
When FastAPI was designed, PEP 593 did not exist, and there are several advantages to using PEP 593's Annotated:</p>
<ul>
<li>Compatible with other uses of default values, like dataclass' <code>field</code> or Pydantic's <code>Field</code>.</li>
<li>Non-invasive modification of signatures: adding <code>Marker(...)</code> in <code>Annotated</code> should be ignored by anything except <code>di</code>.</li>
<li>Functions/classes can be called as normal outside of <code>di</code> and the default values (when present) will be used.</li>
<li>Multiple markers can be used. For example, something like <code>Annotated[T, PydanticField(), Marker()]</code>.</li>
</ul>
<p>This last point is important because of the composability it provides:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Marker</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>

<span class="n">T_int</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T_int&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T_int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">Depends</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Marker</span><span class="p">()]</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Depends</span><span class="p">[</span><span class="n">PositiveInt</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div>
<p>Note how we used <a href="https://www.python.org/dev/peps/pep-0593/#aliases-concerns-over-verbosity">type aliases</a> to create stackable, reusable types.
This means that while <code>Annotated</code> can sometimes be verbose, it can also be made very convenient with type aliases.</p>
<h2 id="custom-types">Custom types</h2>
<p>If you are writing and injecting your own classes, you also have the option of putting the dependency injection metadata into the class itself, via the <code>__di_dependency__(cls) -&gt; Marker</code> protocol. This obviously doesn't work if you are injecting a 3rd party class you are importing (unless you subclass it).</p>
<p>The main advantage of this method is that the consumers of this class (which may be your own codebase) don't have to apply markers everywhere or worry about inconsistent scopes (see <a href="../scopes/">scopes</a>).</p>
<p>For example, we can tell <code>di</code> constructing a class asynchronously`:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">di.dependent</span> <span class="kn">import</span> <span class="n">Dependent</span>
<span class="kn">from</span> <span class="nn">di.executors</span> <span class="kn">import</span> <span class="n">AsyncExecutor</span>


<span class="k">class</span> <span class="nc">HTTPClient</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__di_dependency__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dependent[B]&quot;</span><span class="p">:</span>
        <span class="c1"># note that client is injected by di!</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">client</span><span class="p">:</span> <span class="n">HTTPClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">:</span>
            <span class="c1"># do an http request or something</span>
            <span class="k">return</span> <span class="n">B</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ðŸ‘‹ from </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Dependent</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">msg</span>

    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="n">AsyncExecutor</span><span class="p">()</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Dependent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,))</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="s2">&quot;ðŸ‘‹ from b&quot;</span>
</code></pre></div>
<p>This allows you to construct your class even if it depends on doing async work <em>and</em> it needs to refer to the class itself.</p>
<p>If you only need to do async work and don't need access to the class, you don't need to use this and can instead just make your field depend on an asynchronous function:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">di.dependent</span> <span class="kn">import</span> <span class="n">Dependent</span><span class="p">,</span> <span class="n">Marker</span>
<span class="kn">from</span> <span class="nn">di.executors</span> <span class="kn">import</span> <span class="n">AsyncExecutor</span>
<span class="kn">from</span> <span class="nn">di.typing</span> <span class="kn">import</span> <span class="n">Annotated</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">get_msg</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># make an http request or something</span>
    <span class="k">return</span> <span class="s2">&quot;ðŸ‘‹&quot;</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">msg</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Marker</span><span class="p">(</span><span class="n">get_msg</span><span class="p">)]</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">msg</span>

    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="n">AsyncExecutor</span><span class="p">()</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Dependent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,))</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">state</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="s2">&quot;ðŸ‘‹&quot;</span>
</code></pre></div>
<p>Another way this is useful is to pre-declare scopes for a class.
For example, you may only want to have one <code>UserRepo</code> for you entire app:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">di.dependent</span> <span class="kn">import</span> <span class="n">Dependent</span>
<span class="kn">from</span> <span class="nn">di.executors</span> <span class="kn">import</span> <span class="n">SyncExecutor</span>


<span class="k">class</span> <span class="nc">UsersRepo</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__di_dependency__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dependent[UsersRepo]&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Dependent</span><span class="p">(</span><span class="n">UsersRepo</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;app&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">repo</span><span class="p">:</span> <span class="n">UsersRepo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UsersRepo</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">repo</span>


<span class="k">def</span> <span class="nf">framework</span><span class="p">():</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
        <span class="n">Dependent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;request&quot;</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="n">SyncExecutor</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">app_state</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">app_state</span><span class="p">)</span> <span class="k">as</span> <span class="n">req_state</span><span class="p">:</span>
            <span class="n">repo1</span> <span class="o">=</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_sync</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">req_state</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">app_state</span><span class="p">)</span> <span class="k">as</span> <span class="n">req_state</span><span class="p">:</span>
            <span class="n">repo2</span> <span class="o">=</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_sync</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">req_state</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">repo1</span> <span class="ow">is</span> <span class="n">repo2</span>
</code></pre></div>
<h3 id="injectableclass">InjectableClass</h3>
<p>As a convenience, <code>di</code> provides an <code>InjectableClass</code> type that you can inherit from so that you can easily pass parameters to <code>Marker</code> without implementing <code>__di_dependent__</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">di</span> <span class="kn">import</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">di.dependent</span> <span class="kn">import</span> <span class="n">Dependent</span><span class="p">,</span> <span class="n">Injectable</span>
<span class="kn">from</span> <span class="nn">di.executors</span> <span class="kn">import</span> <span class="n">SyncExecutor</span>


<span class="k">class</span> <span class="nc">UsersRepo</span><span class="p">(</span><span class="n">Injectable</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;app&quot;</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">endpoint</span><span class="p">(</span><span class="n">repo</span><span class="p">:</span> <span class="n">UsersRepo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UsersRepo</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">repo</span>


<span class="k">def</span> <span class="nf">framework</span><span class="p">():</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">Container</span><span class="p">()</span>
    <span class="n">solved</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
        <span class="n">Dependent</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;request&quot;</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">executor</span> <span class="o">=</span> <span class="n">SyncExecutor</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">app_state</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">app_state</span><span class="p">)</span> <span class="k">as</span> <span class="n">request_state</span><span class="p">:</span>
            <span class="n">repo1</span> <span class="o">=</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_sync</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">request_state</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">container</span><span class="o">.</span><span class="n">enter_scope</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">):</span>
            <span class="n">repo2</span> <span class="o">=</span> <span class="n">solved</span><span class="o">.</span><span class="n">execute_sync</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="n">executor</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">request_state</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">repo1</span> <span class="ow">is</span> <span class="n">repo2</span>
</code></pre></div>
<h2 id="binds">Binds</h2>
<p>Binds, which will be covered in depth in the <a href="../binds/">binds</a> section offer a way of swapping out dependencies imperatively (when you encounter type "X", use function "y" to build it).
They can be used with any of the methods described above.</p>
<h2 id="performance">Performance</h2>
<p>Reflection (inspecting function signatures for dependencies) <em>is very slow</em>.
For this reason, <code>di</code> tries to avoid it as much as possible.
The best way to avoid extra introspection is to re-use <a href="../solving/#SolvedDependent">Solved Dependents</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>There are several ways to declare dependencies in <code>di</code>.
Which one makes sense for each use case depends on several factors, but ultimately they all achieve the same outcome.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../architecture/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Architecture" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Architecture
            </div>
          </div>
        </a>
      
      
        
        <a href="../scopes/" class="md-footer__link md-footer__link--next" aria-label="Next: Scopes" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Scopes
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../js/termynal.js"></script>
      
        <script src="../js/custom.js"></script>
      
    
    
  </body>
</html>